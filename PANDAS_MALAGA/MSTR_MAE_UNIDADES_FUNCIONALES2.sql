/* Formatted on 27/03/2014 10:57:06 (QP5 v5.163.1008.3004) PANDAS Copyright (c) 2013 -Davide Moraschi (davidem@eurostrategy.net)
Todos los derechos reservados. Prohibida su reproducción Total o Parcial. */
DROP TABLE MSTR_MAE_UNIDADES_FUNCIONALES2;
CREATE TABLE MSTR_MAE_UNIDADES_FUNCIONALES2
(
    NATID_AREA_HOSPITALARIA
 ,NATID_UNIDAD_FUNCIONAL2
 ,DESCR_UNIDAD_FUNCIONAL2
 ,NATID_UNIDAD_FUNCIONAL1
 ,CONSTRAINT MAE_UNIDADES_FUNCIONALES2_PK PRIMARY KEY (NATID_UNIDAD_FUNCIONAL2)
)
ORGANIZATION INDEX
NOLOGGING
NOMONITORING
NOPARALLEL
STORAGE (BUFFER_POOL KEEP) AS
	SELECT '-1' NATID_AREA_HOSPITALARIA
				,'-1' NATID_UNIDAD_FUNCIONAL2
				,'n/a' DESCR_UNIDAD_FUNCIONAL2
				,'-1' NATID_UNIDAD_FUNCIONAL1
		FROM DUAL
	UNION ALL
	SELECT UF_AH_CODIGO NATID_AREA_HOSPITALARIA
				,UF_CODIGO NATID_UNIDAD_FUNCIONAL2
				,UF_NOMBRE DESCR_UNIDAD_FUNCIONAL2
				,UF_UF_CODIGO NATID_UNIDAD_FUNCIONAL1
		FROM REP_PRO_EST.UNIDADES_FUNCIONALES@SEE41DAE
	 WHERE UF_UF_CODIGO IN (SELECT UF_CODIGO
														FROM REP_PRO_EST.UNIDADES_FUNCIONALES@SEE41DAE
													 WHERE UF_UF_CODIGO IS NULL AND UF_AH_CODIGO IN (SELECT NATID_AREA_HOSPITALARIA FROM MSTR_UTL_LOCAL_CODIGOS))
	UNION ALL
	-- Replica Nivel 1 sin hijos
	SELECT UF_AH_CODIGO NATID_AREA_HOSPITALARIA
				,UF_CODIGO NATID_UNIDAD_FUNCIONAL2
				,UF_NOMBRE || '*' DESCR_UNIDAD_FUNCIONAL2
				,UF_CODIGO NATID_UNIDAD_FUNCIONAL1
		FROM REP_PRO_EST.UNIDADES_FUNCIONALES@SEE41DAE
	 WHERE UF_UF_CODIGO IS NULL AND UF_AH_CODIGO IN (SELECT NATID_AREA_HOSPITALARIA FROM MSTR_UTL_LOCAL_CODIGOS) AND UF_FINAL = 'S';
